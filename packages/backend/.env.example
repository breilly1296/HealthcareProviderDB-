# Database connection string
# For local development with docker-compose:
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/healthcare_providers"

# For production (Cloud SQL, etc):
# DATABASE_URL="postgresql://user:password@host:5432/database?sslmode=require"

# Server configuration
PORT=3001
NODE_ENV=development

# Frontend URL for CORS (Cloud Run frontend service URL)
# Production domains (verifymyprovider.com) are always allowed
# This is for additional origins like Cloud Run service URLs
FRONTEND_URL=https://your-frontend-service-url.run.app

# Optional: API rate limiting (requests per minute)
# RATE_LIMIT_WINDOW_MS=60000
# RATE_LIMIT_MAX_REQUESTS=100

# Admin API secret for protected endpoints (Cloud Scheduler, cleanup jobs)
# Generate with: openssl rand -hex 32
ADMIN_SECRET=your-secure-admin-secret-here

# Google reCAPTCHA v3 for bot protection on verification endpoints
# Get keys at: https://www.google.com/recaptcha/admin
# Leave empty to skip CAPTCHA in production (not recommended)
RECAPTCHA_SECRET_KEY=your-recaptcha-secret-key

# Redis URL for distributed rate limiting (optional)
# When set: Rate limiting uses Redis (works across multiple instances)
# When not set: Falls back to in-memory rate limiting (single instance only)
#
# For Cloud Memorystore: redis://10.x.x.x:6379
# For local Redis: redis://localhost:6379
# For Redis with auth: redis://:password@host:6379
# REDIS_URL=redis://localhost:6379

# CAPTCHA fail mode when Google reCAPTCHA API is unavailable
#
# 'open' (default) - AVAILABILITY priority
#   - Allows requests through if Google API fails
#   - Applies strict fallback rate limiting (3 requests/hour vs normal 10)
#   - Risk: Attackers could exploit Google outages to bypass CAPTCHA
#   - Best for: Beta, user-facing features where uptime is critical
#
# 'closed' - SECURITY priority
#   - Blocks ALL requests if Google API fails
#   - Returns 503 "Security verification temporarily unavailable"
#   - Risk: Legitimate users blocked during Google outages
#   - Best for: Production with high-security requirements
#
# Recommendation: Use 'open' for beta, evaluate 'closed' for production
# Monitor "[CAPTCHA] Google API error" logs to assess outage frequency
#
CAPTCHA_FAIL_MODE=open

# Authentication — Magic Link (passwordless email login)
# JWT secret for signing access & refresh tokens
# Generate with: node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
JWT_SECRET=your-jwt-secret-here

# Resend API key for sending magic link emails
# Get one at: https://resend.com/api-keys
RESEND_API_KEY=re_xxxx

# Base URL for magic link verification (where the backend is reachable)
# In production behind a load balancer: https://verifymyprovider.com
# In local dev: http://localhost:3001
MAGIC_LINK_BASE_URL=http://localhost:3001

# Insurance Card — AES-256-GCM encryption key for PII fields
# Encrypts: subscriber/member ID, group number, Rx BIN/PCN/GRP
# Must be exactly 32 bytes encoded as base64 (44 characters)
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
INSURANCE_ENCRYPTION_KEY=your-base64-encoded-32-byte-key

# Insurance Card — Anthropic API key for AI-powered card scanning
# Used by the backend extractor to call Claude for OCR extraction
# Get one at: https://console.anthropic.com/settings/keys
ANTHROPIC_API_KEY=sk-ant-xxxx
